<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
  <meta name="description" content="This is a study plan website for students. Daily study schedules, tips, and learning guidance.">
  <meta name="keywords" content="study plan, education, student timetable, learning tips">
<meta name="author" content="Theekshana Vidu">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Tracker</title>
<link rel="icon" type="image/png" href="https://img.freepik.com/premium-vector/reading-owl-logo-simple-vector-design_609149-1053.jpg?semt=ais_hybrid&w=740&q=80">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendEmailVerification,
  sendPasswordResetEmail,
  onAuthStateChanged,
  signOut,
  updateProfile,
  updateEmail,
  GoogleAuthProvider,
  signInWithPopup
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, addDoc, collection, getDocs, getDoc, query, where, updateDoc, deleteDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDYhulc8Qz_xGfIeb1g9A6BGO2wwbrz82M",
    authDomain: "study-9c374.firebaseapp.com",
    projectId: "study-9c374",
    storageBucket: "study-9c374.appspot.com",
    messagingSenderId: "82946998504",
    appId: "1:82946998504:web:290cd36a2559846891095d"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const googleProvider = new GoogleAuthProvider();
const ADMIN_UID = "m1rddMA36WbVunFW3B0BzuqOwyI2";

let currentUser = null;
const appContainer = document.getElementById('app-container');
const headerGreeting = document.getElementById('header-greeting');
const headerButtons = document.getElementById('header-buttons');

// ---------- ROUTER SYSTEM ----------
function navigateTo(path) {
    window.history.pushState({}, "", path);
    router();
}

window.onpopstate = () => router();

async function router() {
    const path = window.location.pathname;
    const parts = path.split('/').filter(p => p !== "");

    // Auth Guard
    if (!currentUser && !['login', 'register'].includes(parts[0]) && parts.length > 0) {
        renderWelcome();
        return;
    }

    if (path === "/" || path === "/welcome") {
        if (currentUser) navigateTo('/home');
        else renderWelcome();
    } 
    else if (path === "/login") renderLogin();
    else if (path === "/register") renderRegister();
    else if (path === "/home") renderHome();
    else if (path === "/profile") renderProfile();
    else if (path === "/timetable") renderTimetable();
    else if (path === "/adminpanel") renderAdmin();
    else if (path === "/recording") renderSubjects();
    
    // recording/subject
    else if (parts[0] === "recording" && parts.length === 2) {
        renderType(parts[1]);
    }
    // recording/subject/type
    else if (parts[0] === "recording" && parts.length === 3) {
        renderLessons(parts[1], parts[2]);
    }
    // recording/subject/type/lessonXX
    else if (parts[0] === "recording" && parts.length === 4) {
        const day = parts[3].replace("lesson", "");
        openLessonPage(parts[1], parts[2], day);
    }
    else {
        renderWelcome();
    }
}

// ---------- Greeting ----------
function getGreeting(name){
  const h = new Date().getHours();
  let greeting = h < 12 ? "Good Morning" : h < 17 ? "Good Afternoon" : "Good Evening";
  return name ? `${greeting} ${name}` : greeting;
}
function updateGreeting(){
  const name = currentUser?.displayName;
  const now = new Date();
  headerGreeting.textContent = `${getGreeting(name)} | ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
}
setInterval(updateGreeting, 1000);

// ---------- Auth Listener ----------
onAuthStateChanged(auth, u=>{
  currentUser = u;
  if(currentUser && currentUser.uid===ADMIN_UID) currentUser.displayName="Admin";
  renderHeader();
  router(); // Initial routing
});

// ---------- Header ----------
function renderHeader(){
  headerButtons.innerHTML='';
  if(currentUser){
    headerButtons.appendChild(createLiquidButton("Home",()=>navigateTo('/home')));
    headerButtons.appendChild(createLiquidButton("Time Table", ()=>navigateTo('/timetable')));
    headerButtons.appendChild(createLiquidButton("Profile",()=>navigateTo('/profile')));

    if(currentUser.uid===ADMIN_UID){
      headerButtons.appendChild(createLiquidButton("Admin Panel",()=>navigateTo('/adminpanel')));
    }

    headerButtons.appendChild(createLiquidButton("Logout", async ()=>{
        await signOut(auth);
        navigateTo('/login');
    }));
  }else{
    headerButtons.appendChild(createLiquidButton("Login",()=>navigateTo('/login')));
    headerButtons.appendChild(createLiquidButton("Register",()=>navigateTo('/register')));
  }
}

function createLiquidButton(text, onClick){
  const btn = document.createElement('button');
  btn.className = 'liquid-btn';
  btn.textContent = text;
  btn.onclick = onClick;
  return btn;
}

// ---------- Welcome ----------
function renderWelcome(){
  appContainer.innerHTML = `
  <div class="flex flex-col items-center justify-center h-full gap-6">
    <h2 class="text-3xl font-bold text-white text-center">Welcome to Study Tracker System</h2>
    <div class="flex gap-6 flex-wrap mt-4">
      <button id="welcome-login-btn" class="liquid-btn px-6 py-2 text-white">Login</button>
      <button id="welcome-register-btn" class="liquid-btn px-6 py-2 text-white">Register</button>
    </div>
  </div>`;
  document.getElementById('welcome-login-btn').onclick = () => navigateTo('/login');
  document.getElementById('welcome-register-btn').onclick = () => navigateTo('/register');
}

// ---------- Register ----------
function renderRegister(){
  appContainer.innerHTML = `
  <div class="bg-slate-800 p-6 rounded-xl w-full max-w-md mx-auto space-y-3">
    <h2 class="text-2xl font-bold">Register</h2>
    <form id="reg-form" class="flex flex-col gap-2">
      <label>First Name</label><input id="firstName" type="text" class="input-field" required>
      <label>Last Name</label><input id="lastName" type="text" class="input-field" required>
      <label>Birthday</label><input id="birthday" type="date" class="input-field" required>
      <label>School</label><input id="school" type="text" class="input-field" required>
      <label>Phone</label><input id="phone" type="text" class="input-field" required>
      <label>Exam Year</label>
      <select id="examYear" class="input-field" required>
        <option>2026 A/L</option><option>2027 A/L</option><option>2028 A/L</option>
      </select>
      <label>Email</label><input id="email" type="email" class="input-field" required>
      <label>Password</label><input id="password" type="password" class="input-field" required>
      <button type="submit" class="liquid-btn w-full">Register</button>
      <div id="reg-error" class="text-red-400"></div>
    </form>
    <button class="google-btn w-full mt-3" id="google-register">Continue with Google</button>
  </div>`;
  document.getElementById('reg-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    try{
      const cred = await createUserWithEmailAndPassword(auth,document.getElementById('email').value,document.getElementById('password').value);
      await updateProfile(cred.user,{displayName: document.getElementById('firstName').value + ' ' + document.getElementById('lastName').value});
      await setDoc(doc(db,'users',cred.user.uid),{
        firstName:document.getElementById('firstName').value,
        lastName:document.getElementById('lastName').value,
        birthday:document.getElementById('birthday').value,
        school:document.getElementById('school').value,
        phone:document.getElementById('phone').value,
        examYear:document.getElementById('examYear').value,
        email:document.getElementById('email').value,
        createdAt:new Date().toISOString()
      });
      navigateTo('/home');
    }catch(err){ document.getElementById('reg-error').textContent = err.message; }
  };
}

// ---------- Login ----------
function renderLogin(){
  appContainer.innerHTML = `
  <div id="auth-section" class="bg-slate-800 p-6 rounded-xl w-full max-w-md mx-auto space-y-3">
    <h2 class="text-2xl font-bold">Login</h2>
    <form id="login-form" class="flex flex-col gap-2">
      <input type="email" id="login-email" placeholder="Email" class="input-field" required>
      <input type="password" id="login-pass" placeholder="Password" class="input-field" required>
      <div class="flex justify-between items-center mt-2">
        <button type="submit" class="liquid-btn">Login</button>
      </div>
      <div id="login-error" class="text-red-400"></div>
    </form>
    <button id="google-login" class="google-btn w-full">Continue with Google</button>
    <div id="complete-profile" style="display:none" class="mt-4 space-y-2"></div>
  </div>`;

  document.getElementById('login-form').onsubmit = async e=>{
    e.preventDefault();
    try{
      await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-pass').value);
      navigateTo('/home');
    }catch(err){ document.getElementById('login-error').textContent = err.message; }
  };

  document.getElementById("google-login").onclick = async () => {
    try {
        const result = await signInWithPopup(auth, googleProvider);
        const user = result.user;
        const snap = await getDoc(doc(db, "users", user.uid));
        if (snap.exists()) { navigateTo('/home'); } 
        else {
            const completeProfile = document.getElementById("complete-profile");
            document.getElementById("login-form").style.display = "none";
            completeProfile.style.display = "block";
            const displayName = user.displayName ? user.displayName.split(" ") : ["",""];
            completeProfile.innerHTML = `
                <h2 class="text-xl font-bold">Complete Your Profile</h2>
                <input id="p-fn" placeholder="First Name" class="input-field" value="${displayName[0]}">
                <input id="p-ln" placeholder="Last Name" class="input-field" value="${displayName[1]}">
                <input id="p-em" value="${user.email}" class="input-field" readonly>
                <input id="p-bd" type="date" class="input-field">
                <input id="p-ph" placeholder="Phone" class="input-field">
                <input id="p-sc" placeholder="School" class="input-field">
                <select id="p-ex" class="input-field"><option>2026 A/L</option><option>2027 A/L</option><option>2028 A/L</option></select>
                <button id="save-p-btn" class="liquid-btn w-full">Save</button>
            `;
            document.getElementById("save-p-btn").onclick = async () => {
                const data = {
                    firstName: document.getElementById("p-fn").value,
                    lastName: document.getElementById("p-ln").value,
                    email: user.email,
                    birthday: document.getElementById("p-bd").value,
                    phone: document.getElementById("p-ph").value,
                    school: document.getElementById("p-sc").value,
                    examYear: document.getElementById("p-ex").value,
                    createdAt: new Date().toISOString()
                };
                await setDoc(doc(db, "users", user.uid), data);
                await updateProfile(user, { displayName: `${data.firstName} ${data.lastName}` });
                navigateTo('/home');
            };
        }
    } catch (err) { alert(err.message); }
  };
}

// ---------- Home ----------
async function renderHome(){
  appContainer.innerHTML = `
  <div class="space-y-4 w-full max-w-xl mx-auto">
    <button id="recording-btn" class="liquid-btn w-full text-xl py-4 mb-4">ðŸŽ¥ Recordings</button>
    <h2 class="text-2xl font-bold">Daily Entry</h2>
    <form id="daily-form" class="space-y-2 flex flex-col gap-2">
      <input type="date" name="date" value="${new Date().toISOString().slice(0,10)}" class="input-field" required>
      <input type="number" name="hours" placeholder="Hours studied" class="input-field" required>
      <button class="liquid-btn w-full">Save / Add</button>
      <div id="daily-msg" class="text-green-400"></div>
    </form>
    <h3 class="text-xl font-bold mt-4">Update Entry</h3>
    <form id="update-today-form" class="flex flex-col gap-2">
      <input type="date" name="updateDate" class="input-field" value="${new Date().toISOString().slice(0,10)}" required>
      <input type="number" name="updateHours" placeholder="New hours" class="input-field">
      <button class="liquid-btn w-full">Update</button>
      <div id="update-msg" class="text-green-400"></div>
    </form>
    <h2 class="text-2xl font-bold mt-4">Weekly Chart</h2><canvas id="weekly-chart" class="bg-slate-800 rounded p-2"></canvas>
    <h2 class="text-2xl font-bold mt-4">Monthly Chart</h2><canvas id="monthly-chart" class="bg-slate-800 rounded p-2"></canvas>
  </div>`;

  document.getElementById('daily-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    const logsSnap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',currentUser.uid), where('date','==',f.date.value)));
    if(logsSnap.docs.length){ await updateDoc(doc(db,'studyLogs',logsSnap.docs[0].id), {hours: Number(f.hours.value)}); } 
    else { await addDoc(collection(db,'studyLogs'), {userId: currentUser.uid, date: f.date.value, hours: Number(f.hours.value), createdAt:new Date().toISOString()}); }
    renderCharts();
  };
  document.getElementById("recording-btn").onclick = () => navigateTo('/recording');
  renderCharts();
}

// ---------- Charts ----------
async function renderCharts(userId = currentUser.uid){
  const snap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',userId)));
  const data = snap.docs.map(d=>d.data());
  const weekly=[], monthly={};
  const today = new Date();

  for(let i=6;i>=0;i--){
    const d = new Date(); d.setDate(today.getDate()-i);
    const ds = d.toISOString().slice(0,10);
    weekly.push(data.filter(x=>x.date===ds).reduce((a,b)=>a+b.hours,0));
  }
  data.forEach(x=>{ const m = x.date.slice(0,7); monthly[m] = (monthly[m] || 0) + x.hours; });

  const ctxW = document.getElementById('weekly-chart');
  if(ctxW){
    window.weeklyChart?.destroy();
    window.weeklyChart = new Chart(ctxW.getContext('2d'),{
      type:'line',
      data:{
        labels:Array.from({length:7},(_,i)=>{const d=new Date(); d.setDate(today.getDate()-6+i); return d.toISOString().slice(5,10);}),
        datasets:[{label:'Hours', data:weekly, borderColor:'#8b5cf6', backgroundColor:'rgba(139,92,246,0.3)', fill:true}]
      },
      options: { scales: { y: { beginAtZero: true, ticks: {color:'#fff'} }, x: { ticks:{color:'#fff'} } }, plugins: { legend: { labels: { color: '#fff' } } } }
    });
  }

  const ctxM = document.getElementById('monthly-chart');
  if(ctxM){
    window.monthlyChart?.destroy();
    window.monthlyChart = new Chart(ctxM.getContext('2d'),{
      type:'line',
      data:{
        labels:Object.keys(monthly),
        datasets:[{label:'Hours', data:Object.values(monthly), borderColor:'#22d3ee', backgroundColor:'rgba(34,211,238,0.3)', fill:true}]
      },
      options: { scales: { y: { beginAtZero: true, ticks: {color:'#fff'} }, x: { ticks:{color:'#fff'} } }, plugins: { legend: { labels: { color: '#fff' } } } }
    });
  }
}

// ---------- Profile ----------
async function renderProfile(){
  const snap = await getDoc(doc(db,'users',currentUser.uid));
  const u = snap.data();
  appContainer.innerHTML = `
  <div class="bg-slate-800 p-6 rounded-xl max-w-md mx-auto space-y-4">
    <h2 class="text-2xl font-bold">${u.firstName} ${u.lastName}</h2>
    <form id="profile-form" class="flex flex-col gap-2">
      <label>First Name</label><input type="text" name="firstName" class="input-field" value="${u.firstName}">
      <label>Last Name</label><input type="text" name="lastName" class="input-field" value="${u.lastName}">
      <label>School</label><input type="text" name="school" class="input-field" value="${u.school}">
      <button type="submit" class="liquid-btn w-full">Update Profile</button>
      <div id="profile-msg" class="text-green-400"></div>
    </form>
  </div>`;
  document.getElementById('profile-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    await updateDoc(doc(db,'users',currentUser.uid), {firstName:f.firstName.value, lastName:f.lastName.value, school:f.school.value});
    document.getElementById('profile-msg').textContent = 'Profile updated!';
  };
}

// ---------- Time Table ----------
async function renderTimetable() {
  const ttRef = doc(db, "timetable", currentUser.uid);
  const ttSnap = await getDoc(ttRef);
  const savedData = ttSnap.exists() ? ttSnap.data() : {};
  const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
  const hours = Array.from({length:24}, (_,i)=>{
    const fmt = (hr)=> { const h = hr%12||12; return `${h}${hr<12?'am':'pm'}`; };
    return `${fmt(i)} - ${fmt(i+1)}`;
  });

  appContainer.innerHTML = `
    <div class="bg-slate-800 p-4 rounded-xl w-full">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">Weekly Time Table</h2>
        <button id="save-timetable" class="liquid-btn">Save</button>
      </div>
      <div class="overflow-x-auto">
        <table class="border border-slate-600 text-sm min-w-max">
          <thead><tr><th class="border p-2">Hour</th>${days.map(d=>`<th class="border p-2">${d}</th>`).join("")}</tr></thead>
          <tbody>
            ${hours.map((h, hi)=>`<tr><td class="border p-2 font-bold">${h}</td>
            ${days.map((_, di)=>`<td class="border p-1"><input id="tt_${di}_${hi}" class="bg-slate-900 p-1 rounded w-24 text-center" value="${savedData[`tt_${di}_${hi}`]||''}"></td>`).join("")}
            </tr>`).join("")}
          </tbody>
        </table>
      </div>
    </div>`;
  document.getElementById("save-timetable").onclick = async ()=>{
    const saveObj = {};
    days.forEach((_,d)=> hours.forEach((_,h)=>{
      const val = document.getElementById(`tt_${d}_${h}`).value;
      if(val) saveObj[`tt_${d}_${h}`] = val;
    }));
    await setDoc(ttRef, saveObj);
    alert("Saved!");
  };
}

// ---------- Subjects & Recordings ----------
function renderSubjects(){
  appContainer.innerHTML = `
    <h2 class="text-2xl font-bold mb-6">Select Subject</h2>
    <div class="flex flex-col gap-4">
      <button onclick="navigateTo('/recording/combine')" class="flex items-center gap-4 bg-slate-800 p-4 rounded-xl hover:bg-slate-700">
        <img src="https://api.combinedmaths.lk/files-public/profiles/281124/1862199793225306112.jpg" class="w-24 h-24 rounded-xl object-cover">
        <span class="text-xl font-bold">Combine Maths - Ruwan Darshana</span>
      </button>
      <button onclick="navigateTo('/recording/physics')" class="flex items-center gap-4 bg-slate-800 p-4 rounded-xl hover:bg-slate-700">
        <img src="https://static.indeepa.lk/lecturer/7/en/652248466c448.jpg" class="w-24 h-24 rounded-xl object-cover">
        <span class="text-xl font-bold">Physics - Anuradha Perera</span>
      </button>
      <button onclick="navigateTo('/recording/chemistry')" class="flex items-center gap-4 bg-slate-800 p-4 rounded-xl hover:bg-slate-700">
        <img src="https://static.indeepa.lk/lecturer/6/en/6522475ddf2bf.jpg" class="w-24 h-24 rounded-xl object-cover">
        <span class="text-xl font-bold">Chemistry - Amila Dasanayake</span>
      </button>
    </div>`;
}

function renderType(subject){
  appContainer.innerHTML = `
    <h2 class="text-2xl font-bold mb-6">${subject.toUpperCase()}</h2>
    <div class="flex gap-6">
      <button class="liquid-btn text-xl px-8 py-4" onclick="navigateTo('/recording/${subject}/theory')">Theory</button>
      <button class="liquid-btn text-xl px-8 py-4" onclick="navigateTo('/recording/${subject}/revision')">Revision</button>
    </div>`;
}

async function renderLessons(subject, type){
  appContainer.innerHTML = `<h2 class="text-2xl font-bold mb-4">${subject.toUpperCase()} - ${type.toUpperCase()}</h2><div id="lessons-list" class="flex flex-col gap-3"></div>`;
  const list = document.getElementById("lessons-list");
  let lessonsData = {};
  const snap = await getDocs(query(collection(db,"lessons"), where("subject","==",subject), where("type","==",type)));
  snap.forEach(doc=> { lessonsData[doc.data().day] = doc.data().title; });

  for(let i=1;i<=20;i++){
    const day = String(i).padStart(2,"0");
    const title = lessonsData[day] || `Day ${day} - Lesson Title`;
    const row = document.createElement("div");
    row.className = "flex gap-2 items-center";
    const btn = document.createElement("button");
    btn.className = "liquid-btn flex-1";
    btn.textContent = title;
    btn.onclick = () => navigateTo(`/recording/${subject}/${type}/lesson${day}`);
    row.appendChild(btn);
    if(currentUser?.uid === ADMIN_UID){
        const eb = document.createElement("button"); eb.className="liquid-btn bg-yellow-600"; eb.textContent="âœï¸";
        eb.onclick = async () => {
            const nt = prompt("New Title:", title);
            if(nt){ await setDoc(doc(db,"lessons",`${subject}_${type}_${day}`), {title:nt, subject, type, day}); renderLessons(subject, type); }
        };
        row.appendChild(eb);
    }
    list.appendChild(row);
  }
}

async function openLessonPage(subject, type, day){
  const lessonId = `${subject}_${type}_${day}`;
  appContainer.innerHTML = `<h2 class="text-2xl font-bold mb-4">Lesson ${day}</h2><div id="content-list" class="flex flex-col gap-3 mb-6"></div>
  ${currentUser?.uid === ADMIN_UID ? `<div class="flex gap-2"><input id="c-txt" placeholder="Text" class="input-field"><input id="c-lnk" placeholder="Link" class="input-field"><button id="add-c" class="liquid-btn">Add</button></div>`:''}`;
  
  const load = async () => {
    const cl = document.getElementById("content-list"); cl.innerHTML = "";
    const snap = await getDocs(query(collection(db,"lessonContents"), where("lessonId","==",lessonId), orderBy("order","asc")));
    snap.forEach(ds=>{
      const d = ds.data();
      const div = document.createElement("div"); div.className="border p-3 flex justify-between bg-slate-800 rounded";
      div.innerHTML = `<a href="${d.link}" target="_blank" class="text-blue-400 underline">${d.text}</a>`;
      if(currentUser?.uid===ADMIN_UID){
          const del = document.createElement("button"); del.textContent="ðŸ—‘ï¸"; 
          del.onclick=async()=>{ await deleteDoc(doc(db,"lessonContents",ds.id)); load(); };
          div.appendChild(del);
      }
      cl.appendChild(div);
    });
  };
  load();
  if(document.getElementById("add-c")){
      document.getElementById("add-c").onclick = async () => {
          const t = document.getElementById("c-txt").value; const l = document.getElementById("c-lnk").value;
          await addDoc(collection(db,"lessonContents"), {lessonId, text:t, link:l, order:Date.now()});
          load();
      };
  }
}

// ---------- Admin Panel ----------
async function renderAdmin() {
  appContainer.innerHTML = `<h2 class="text-2xl font-bold mb-4">Admin Panel</h2><input id="admin-search" placeholder="Search..." class="input-field mb-4"><div id="admin-users" class="space-y-2"></div><div id="admin-user-details" class="mt-6"></div>`;
  const usersSnap = await getDocs(collection(db,'users'));
  const users = usersSnap.docs.map(d => ({ id: d.id, ...d.data() }));
  const container = document.getElementById('admin-users');
  const draw = (list) => {
    container.innerHTML = '';
    list.forEach(u => {
      const div = document.createElement('div'); div.className = 'bg-slate-800 p-3 rounded flex justify-between items-center';
      div.innerHTML = `<div>${u.firstName} ${u.lastName} (${u.email})</div><button class="liquid-btn v-btn">View</button>`;
      div.querySelector('.v-btn').onclick = () => renderAdminUserDetails(u.id);
      container.appendChild(div);
    });
  };
  draw(users);
}

async function renderAdminUserDetails(uid){
  const userSnap = await getDoc(doc(db,'users',uid));
  const u = userSnap.data();
  document.getElementById('admin-user-details').innerHTML = `<div class="bg-slate-800 p-4 rounded"><h3>${u.firstName} ${u.lastName}</h3><p>${u.email}</p><canvas id="a-chart"></canvas></div>`;
  renderCharts(uid);
}

window.navigateTo = navigateTo;
</script>

<style>
body{background:black;color:white;min-height:100vh;font-family:sans-serif;}
.input-field{padding:0.5rem;border-radius:0.5rem;background:#1e293b;border:none;color:white;width:100%;margin-bottom:0.5rem;}
.liquid-btn{position:relative;padding:0.5rem 1.5rem;color:white;overflow:hidden;border:none;border-radius:1rem;background:#0ea5e9;cursor:pointer;font-weight:bold;margin:0.2rem;transition:0.3s;}
.liquid-btn:hover{box-shadow:0 0 15px #0ea5e9;}
.google-btn { padding: 0.5rem; border: 2px solid #0ea5e9; border-radius: 0.5rem; background: transparent; color: white; font-weight: bold; cursor: pointer; }
</style>
</head>
<body class="flex flex-col items-center justify-start p-4">

<header class="w-full p-4 bg-slate-900 shadow-lg flex justify-between items-center flex-wrap">
  <h1 class="text-2xl font-bold cursor-pointer" onclick="navigateTo('/home')">StudyTracker</h1>
  <div id="header-greeting" class="text-sm"></div>
  <div id="header-buttons" class="flex gap-2 flex-wrap"></div>
</header>

<main class="flex-1 w-full max-w-4xl mt-4" id="app-container"></main>

<footer class="text-sm text-slate-400 mt-8 w-full text-center">Â© Owner 2026</footer>

</body>
</html>
