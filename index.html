<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="This is a study plan website for students. Daily study schedules, tips, and learning guidance.">
<meta name="keywords" content="study plan, education, student timetable, learning tips">
<meta name="author" content="Theekshana Vidu">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Tracker</title>
<link rel="icon" type="image/png" href="https://img.freepik.com/premium-vector/reading-owl-logo-simple-vector-design_609149-1053.jpg?semt=ais_hybrid&w=740&q=80">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-slate-900 text-white">
<header class="p-4 flex justify-between items-center bg-slate-800">
  <div id="header-greeting">Loading...</div>
  <div id="header-buttons" class="flex gap-2"></div>
</header>
<main id="app-container" class="p-4"></main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile, updateEmail, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, addDoc, collection, getDocs, getDoc, query, where, updateDoc, deleteDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDYhulc8Qz_xGfIeb1g9A6BGO2wwbrz82M",
    authDomain: "study-9c374.firebaseapp.com",
    projectId: "study-9c374",
    storageBucket: "study-9c374.appspot.com",
    messagingSenderId: "82946998504",
    appId: "1:82946998504:web:290cd36a2559846891095d"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const googleProvider = new GoogleAuthProvider();
const ADMIN_UID = "m1rddMA36WbVunFW3B0BzuqOwyI2";
let currentUser = null;
const appContainer = document.getElementById('app-container');
const headerGreeting = document.getElementById('header-greeting');
const headerButtons = document.getElementById('header-buttons');

// ------------------- GREETING -------------------
function getGreeting(name){
  const h = new Date().getHours();
  let greeting = h < 12 ? "Good Morning" : h < 17 ? "Good Afternoon" : "Good Evening";
  return name ? `${greeting} ${name}` : greeting;
}
function updateGreeting(){
  const name = currentUser?.displayName;
  const now = new Date();
  headerGreeting.textContent = `${getGreeting(name)} | ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
}
setInterval(updateGreeting, 1000);

// ------------------- HEADER -------------------
function renderHeader(){
  headerButtons.innerHTML='';
  if(currentUser){
    const homeBtn = createLiquidButton("Home",()=>{router("/home")});
    const profileBtn = createLiquidButton("Profile",()=>{router("/profile")});
    const timetableBtn = createLiquidButton("Time Table", ()=>{router("/timetable")});
    headerButtons.appendChild(timetableBtn);
    headerButtons.appendChild(homeBtn);
    headerButtons.appendChild(profileBtn);
    if(currentUser.uid===ADMIN_UID){
      const adminBtn = createLiquidButton("Admin Panel",()=>{router("/adminpanal")});
      headerButtons.appendChild(adminBtn);
    }
    const logoutBtn = createLiquidButton("Logout", async ()=>{await signOut(auth); router("/login");});
    headerButtons.appendChild(logoutBtn);
  }else{
    const loginBtn = createLiquidButton("Login",()=>{router("/login")});
    const regBtn = createLiquidButton("Register",()=>{router("/register")});
    headerButtons.appendChild(loginBtn);
    headerButtons.appendChild(regBtn);
  }
}
function createLiquidButton(text, onClick){
  const btn = document.createElement('button');
  btn.className = 'liquid-btn';
  btn.textContent = text;
  btn.onclick = onClick;
  return btn;
}

// ------------------- AUTH STATE -------------------
onAuthStateChanged(auth, u=>{
  currentUser = u;
  if(currentUser && currentUser.uid===ADMIN_UID) currentUser.displayName="Admin";
  renderHeader();
  if(!location.pathname || location.pathname==="/") router(currentUser?"/home":"/login");
  else router(location.pathname);
});

// ------------------- ROUTER -------------------
function router(path){
  path = path || "/";
  history.pushState({}, "", path);
  const segments = path.split("/").filter(Boolean);

  if(segments[0]==="login") renderLogin();
  else if(segments[0]==="register") renderRegister();
  else if(segments[0]==="home") renderHome();
  else if(segments[0]==="profile") renderProfile();
  else if(segments[0]==="timetable") renderTimetable();
  else if(segments[0]==="adminpanal") renderAdmin();
  else if(segments[0]==="recording"){
    if(segments[1]){ // chemistry, physics, combine
      const subject = segments[1];
      if(segments[2]==="revision" || segments[2]==="theory"){
        const type = segments[2];
        if(segments[3] && segments[3].startsWith("lesson")) {
          const lessonNum = segments[3].replace("lesson","");
          openLessonPage(subject,type,lessonNum);
        } else renderLessons(subject,type);
      } else renderType(subject);
    } else renderSubjects();
  } else renderWelcome();
}

// handle back/forward browser buttons
window.onpopstate = () => router(location.pathname);

// ------------------- PLACEHOLDER FOR EXISTING FUNCTIONS -------------------
// All your functions for renderWelcome, renderLogin, renderRegister, renderHome, renderProfile, renderTimetable, renderSubjects, renderType, renderLessons, openLessonPage, renderAdmin, etc., remain unchanged.
// Copy all your existing JS code here without modification (as in your original HTML/JS file).

// ---------- Header ----------
function renderHeader(){
  headerButtons.innerHTML='';
  if(currentUser){
    const homeBtn = createLiquidButton("Home",()=>renderHome());
    const profileBtn = createLiquidButton("Profile",()=>renderProfile());
    const timetableBtn = createLiquidButton("Time Table", ()=>renderTimetable());
    headerButtons.appendChild(timetableBtn);
    headerButtons.appendChild(homeBtn);
    headerButtons.appendChild(profileBtn);

    if(currentUser.uid===ADMIN_UID){
      const adminBtn = createLiquidButton("Admin Panel",()=>renderAdmin());
      headerButtons.appendChild(adminBtn);
    }

    const logoutBtn = createLiquidButton("Logout", async ()=>await signOut(auth));
    headerButtons.appendChild(logoutBtn);

  }else{
    const loginBtn = createLiquidButton("Login",()=>renderLogin());
    const regBtn = createLiquidButton("Register",()=>renderRegister());
    headerButtons.appendChild(loginBtn);
    headerButtons.appendChild(regBtn);
  }
}

// ---------- Liquid Button Helper ----------
function createLiquidButton(text, onClick){
  const btn = document.createElement('button');
  btn.className = 'liquid-btn';
  btn.textContent = text;
  btn.onclick = onClick;
  return btn;
}

// ---------- Welcome ----------
function renderWelcome(){
  appContainer.innerHTML = `
  <div class="flex flex-col items-center justify-center h-full gap-6">
    <h2 class="text-3xl font-bold text-white text-center">Welcome to Study Tracker System</h2>
    <div class="flex gap-6 flex-wrap mt-4">
      <button id="welcome-login-btn" class="liquid-btn px-6 py-2 text-white">Login</button>
      <button id="welcome-register-btn" class="liquid-btn px-6 py-2 text-white">Register</button>
    </div>
  </div>`;

  document.getElementById('welcome-login-btn').onclick = () => renderLogin();
  document.getElementById('welcome-register-btn').onclick = () => renderRegister();
}

// ---------- Register ----------
function renderRegister(){
  appContainer.innerHTML = `
  <div class="bg-slate-800 p-6 rounded-xl w-full max-w-md mx-auto space-y-3">
    <h2 class="text-2xl font-bold">Register</h2>
    <form id="reg-form" class="flex flex-col gap-2">
      
      <label for="firstName">First Name</label>
      <input id="firstName" type="text" name="firstName" placeholder="First Name" class="input-field" required>
      
      <label for="lastName">Last Name</label>
      <input id="lastName" type="text" name="lastName" placeholder="Last Name" class="input-field" required>
      
      <label for="birthday">Birthday</label>
      <input id="birthday" type="date" name="birthday" class="input-field" required>
      
      <label for="school">School</label>
      <input id="school" type="text" name="school" placeholder="School" class="input-field" required>
      
      <label for="phone">Phone</label>
      <input id="phone" type="text" name="phone" placeholder="Phone" class="input-field" required>
      
      <label for="examYear">Exam Year</label>
      <select id="examYear" name="examYear" class="input-field" required>
        <option>2026 A/L</option>
        <option>2027 A/L</option>
        <option>2028 A/L</option>
      </select>
      
      <label for="email">Email</label>
      <input id="email" type="email" name="email" placeholder="Email" class="input-field" required>
      
      <label for="password">Password</label>
      <input id="password" type="password" name="password" placeholder="Password" class="input-field" required>
      
      <button type="submit" class="liquid-btn w-full">Register</button>
      <div id="reg-error" class="text-red-400"></div>
    </form>
        <button class="google-btn w-full mt-3" id="google-register">
     <img src="https://img.freepik.com/premium-vector/google-logo-icon-transparent-background_1273375-1570.jpg?semt=ais_hybrid&w=740&q=80" class="google-logo" alt="Google logo">
     Continue with Google
       </button>

    </div>`;
  document.getElementById('reg-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    try{
      const cred = await createUserWithEmailAndPassword(auth,f.email.value,f.password.value);
      await updateProfile(cred.user,{displayName: f.firstName.value + ' ' + f.lastName.value});
      await setDoc(doc(db,'users',cred.user.uid),{
        firstName:f.firstName.value,
        lastName:f.lastName.value,
        birthday:f.birthday.value,
        school:f.school.value,
        phone:f.phone.value,
        examYear:f.examYear.value,
        email:f.email.value,
        createdAt:new Date().toISOString()
      });
    }catch(err){ document.getElementById('reg-error').textContent = err.message; }
  };
 }

// ---------- Login ----------
function renderLogin(){
  appContainer.innerHTML = `
  <div id="auth-section" class="bg-slate-800 p-6 rounded-xl w-full max-w-md mx-auto space-y-3">
  
  <h2 class="text-2xl font-bold">Login</h2>

  <form id="login-form" class="flex flex-col gap-2">
    <input type="email" name="email" placeholder="Email" class="input-field" required>
    <input type="password" name="password" placeholder="Password" class="input-field" required>

    <div class="flex justify-between items-center mt-2">
      <button type="submit" class="liquid-btn">Login</button>
      <button type="button" id="forgot-pass" class="text-sm text-slate-300">Forgot?</button>
    </div>

    <div id="login-error" class="text-red-400"></div>
  </form>
    <button id="google-login" class="google-btn">
  <img src="https://img.freepik.com/premium-vector/google-logo-icon-transparent-background_1273375-1570.jpg?semt=ais_hybrid&w=740&q=80" alt="Google" class="google-logo">
  Continue with Google
</button>



  <!-- üëá COMPLETE PROFILE INSIDE -->
  <div id="complete-profile" style="display:none" class="mt-4 space-y-2">
    <h2 class="text-xl font-bold">Complete Your Profile</h2>
    <input id="profile-name" placeholder="Full Name" class="input-field">
    <input id="profile-class" placeholder="Class / Grade" class="input-field">
    <input id="profile-school" placeholder="School" class="input-field">
    <button onclick="saveProfile()" class="liquid-btn w-full">Save</button>
  </div>

</div>`;
document.getElementById('login-form').onsubmit = async e=>{
  e.preventDefault();
  const f = e.target;
  try{
    const cred = await signInWithEmailAndPassword(auth,f.email.value,f.password.value);
    currentUser = cred.user;       // ‚úÖ update currentUser
    renderHeader();                // ‚úÖ update header buttons
    renderHome();                  // ‚úÖ redirect to Home
  }catch(err){ 
    document.getElementById('login-error').textContent = err.message; 
  }
};


  document.getElementById("google-login").onclick = async () => {
  try {
    const result = await signInWithPopup(auth, googleProvider);
    const user = result.user;

    // check if user profile exists in Firestore
    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (snap.exists()) {
      // User already exists ‚Üí go to dashboard/home
      currentUser = user;
      renderHome();
    } else {
      // New user ‚Üí open complete profile form
      renderLogin(); // ensure login page is rendered with complete-profile div
      const completeProfile = document.getElementById("complete-profile");
      const loginForm = document.getElementById("login-form");

      if (!completeProfile || !loginForm) return;

      loginForm.style.display = "none";
      completeProfile.style.display = "block";

      // prefill name and email from Google
      const displayName = user.displayName ? user.displayName.split(" ") : ["",""];
      completeProfile.innerHTML = `
        <h2 class="text-xl font-bold">Complete Your Profile</h2>
	<label for="profile-firstName">First Name</label>
        <input id="profile-firstName" placeholder="First Name" class="input-field" value="${displayName[0]}">

 	<label for="profile-lastName">Last Name</label>
        <input id="profile-lastName" placeholder="Last Name" class="input-field" value="${displayName[1]}">

	<label for="profile-email">Email</label>
        <input id="profile-email" placeholder="Email" class="input-field" value="${user.email}" readonly>

 	<label for="profile-birthday">Birthday</label>
        <input id="profile-birthday" type="date" class="input-field" placeholder="Birthday">

 	<label for="profile-phone">Phone</label>
        <input id="profile-phone" placeholder="Phone" class="input-field">

	<label for="profile-school">School</label>
        <input id="profile-school" placeholder="School" class="input-field">

        <select id="profile-examYear" class="input-field">
          <option>2026 A/L</option>
          <option>2027 A/L</option>
          <option>2028 A/L</option>
        </select>
        <button id="save-profile-btn" class="liquid-btn w-full">Save</button>
      `;

      // attach saveProfile
      document.getElementById("save-profile-btn").onclick = async () => {
        const data = {
          firstName: document.getElementById("profile-firstName").value.trim(),
          lastName: document.getElementById("profile-lastName").value.trim(),
          email: user.email,
          birthday: document.getElementById("profile-birthday").value,
          phone: document.getElementById("profile-phone").value.trim(),
          school: document.getElementById("profile-school").value.trim(),
          examYear: document.getElementById("profile-examYear").value,
          createdAt: new Date().toISOString()
        };

        await setDoc(doc(db, "users", user.uid), data);
        await updateProfile(user, { displayName: `${data.firstName} ${data.lastName}` });

        alert("Profile saved!");
        currentUser = user;
        renderHome();
      };
    }
  } catch (err) {
    alert(err.message);
  }
};
}

async function saveProfile() {
  const user = auth.currentUser;
  if (!user) return;

  const data = {
    firstName: document.getElementById("profile-firstName").value.trim(),
    lastName: document.getElementById("profile-lastName").value.trim(),
    email: document.getElementById("profile-email").value.trim(),
    birthday: document.getElementById("profile-birthday").value.trim(),
    phone: document.getElementById("profile-phone").value.trim(),
    school: document.getElementById("profile-school").value.trim(),
    examYear: document.getElementById("profile-examYear").value.trim(),
    createdAt: new Date().toISOString()
  };

  await setDoc(doc(db, "users", user.uid), data);
  await updateProfile(user, { displayName: `${data.firstName} ${data.lastName}` });

  alert("Profile saved!");
  renderHome();
}

// Button attach ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
document.getElementById("save-profile-btn").onclick = saveProfile;


// ---------- Home ----------
async function renderHome(){
  appContainer.innerHTML = `
  <div class="space-y-4 w-full max-w-xl mx-auto">
    <button id="recording-btn" class="liquid-btn w-full text-xl py-4 mb-4">
  üé• Recordings
</button>
    <h2 class="text-2xl font-bold">Daily Entry</h2>

    <!-- Save Today's Entry -->
    <form id="daily-form" class="space-y-2 flex flex-col gap-2">
      <input type="date" name="date" value="${new Date().toISOString().slice(0,10)}" class="input-field" required>
      <input type="number" name="hours" placeholder="Hours studied" min="0" max="24" class="input-field" required>
      <button class="liquid-btn w-full">Save / Add</button>
      <div id="daily-msg" class="text-green-400"></div>
    </form>

    <!-- Update Today's Entry -->
    <h3 class="text-xl font-bold mt-4">Update Entry</h3>
    <form id="update-today-form" class="flex flex-col gap-2">
      <input type="date" name="updateDate" class="input-field" value="${new Date().toISOString().slice(0,10)}" required>
      <input type="number" name="updateHours" placeholder="New hours" min="0" max="24" class="input-field">
      <button class="liquid-btn w-full">Update</button>
      <div id="update-msg" class="text-green-400"></div>
    </form>

    <h2 class="text-2xl font-bold mt-4">Weekly Chart</h2>
    <canvas id="weekly-chart" class="bg-slate-800 rounded p-2"></canvas>
    <h2 class="text-2xl font-bold mt-4">Monthly Chart</h2>
    <canvas id="monthly-chart" class="bg-slate-800 rounded p-2"></canvas>
  </div>`;

  // ---------- Add / Save Entry ----------
    
  document.getElementById('daily-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    const today = f.date.value;
    if(Number(f.hours.value) > 24){ alert("Maximum hours per day is 24"); return; }

    const logsSnap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',currentUser.uid), where('date','==',today)));
    if(logsSnap.docs.length){
      const docId = logsSnap.docs[0].id;
      await updateDoc(doc(db,'studyLogs',docId), {hours: Number(f.hours.value)});
      document.getElementById('daily-msg').textContent = 'Updated!';
    } else {
      await addDoc(collection(db,'studyLogs'), {userId: currentUser.uid, date: today, hours: Number(f.hours.value), createdAt:new Date().toISOString()});
      document.getElementById('daily-msg').textContent = 'Saved!';
    }
    renderCharts();
  };
document.getElementById("recording-btn").onclick = () => {
  renderSubjects();
};


  // ---------- Update Entry ----------
  document.getElementById('update-today-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    const today = f.updateDate.value; // <-- user-selected date
    const newHours = Number(f.updateHours.value);
    if(newHours > 24){ alert("Maximum hours per day is 24"); return; }

    const logsSnap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',currentUser.uid), where('date','==',today)));
    if(logsSnap.docs.length){
      const docId = logsSnap.docs[0].id;
      await updateDoc(doc(db,'studyLogs',docId), {hours: newHours});
      document.getElementById('update-msg').textContent = `Entry for ${today} updated!`;
      f.updateHours.value = '';
    } else {
      alert(`No entry for ${today}. Please add it first.`);
    }
    renderCharts();
  };

  // ---------- Render Charts ----------
  renderCharts();
}

// ---------- Charts ----------
async function renderCharts(userId = currentUser.uid){
  const snap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',userId)));
  const data = snap.docs.map(d=>d.data());
  const weekly=[], monthly={};
  const today = new Date();

  // Weekly aggregation (last 7 days)
  for(let i=6;i>=0;i--){
    const d = new Date();
    d.setDate(today.getDate()-i);
    const ds = d.toISOString().slice(0,10);
    weekly.push(data.filter(x=>x.date===ds).reduce((a,b)=>a+b.hours,0));
  }

  // Monthly aggregation
  data.forEach(x=>{
    const month = x.date.slice(0,7); // e.g. "2025-12"
    monthly[month] = (monthly[month] || 0) + x.hours;
  });

  // Sort months chronologically
  const months = Object.keys(monthly).sort((a,b)=>{
    const [yearA, monthA] = a.split('-').map(Number);
    const [yearB, monthB] = b.split('-').map(Number);
    return yearA === yearB ? monthA - monthB : yearA - yearB;
  });
  const values = months.map(m => monthly[m]);

  // ---------- Weekly chart ----------
  const ctxW = document.getElementById('weekly-chart');
  if(ctxW){
    const ctx = ctxW.getContext('2d');
    window.weeklyChart?.destroy();
    window.weeklyChart = new Chart(ctx,{
      type:'line',
      data:{
        labels:Array.from({length:7},(_,i)=>{const d=new Date(); d.setDate(today.getDate()-6+i); return d.toISOString().slice(5,10);}),
        datasets:[{label:'Hours', data:weekly, borderColor:'#8b5cf6', backgroundColor:'rgba(139,92,246,0.3)', fill:true}]
      },
      options: {
  responsive: true,
  plugins: {
    legend: { labels: { color: '#fff' } }
  },
  scales: {
    x: {
      ticks: { color: '#fff' }
    },
    y: {
      ticks: { color: '#fff' },
      beginAtZero: true   // ‚úÖ THIS LINE
    }
  }
}
    });
  }


  // ---------- Monthly chart ----------
  const ctxM = document.getElementById('monthly-chart');
  if(ctxM){
    const ctx = ctxM.getContext('2d');
    window.monthlyChart?.destroy();

// Sort months
  const months = Object.keys(monthly).sort((a, b) => {
    const [yA, mA] = a.split("-").map(Number);
    const [yB, mB] = b.split("-").map(Number);
    return yA === yB ? mA - mB : yA - yB;
  });

  // Get values
  const values = months.map(m => monthly[m]);

  // Format labels: Jan 2026, Feb 2026 ...
  const monthLabels = months.map(m => {
    const [year, month] = m.split("-");
    return new Date(year, month - 1)
      .toLocaleString("en", { month: "short", year: "numeric" });
  });

    window.monthlyChart = new Chart(ctx,{
      type:'line',
      data:{
        labels:monthLabels,
        datasets:[{label:'Hours', data:values, borderColor:'#22d3ee', backgroundColor:'rgba(34,211,238,0.3)', fill:true}]
      },
      options: {
  responsive: true,
  plugins: {
    legend: { labels: { color: '#fff' } }
  },
  scales: {
    x: {
      ticks: { color: '#fff' }
    },
    y: {
      ticks: { color: '#fff' },
      beginAtZero: true   // ‚úÖ THIS LINE
    }
  }
}
    });
  }
}



// ---------- Profile ----------
async function renderProfile(){
  const snap = await getDoc(doc(db,'users',currentUser.uid));
  if(!snap.exists()){ alert('Profile not found'); return; }
  const u = snap.data();
  appContainer.innerHTML = `
  <div class="bg-slate-800 p-6 rounded-xl max-w-md mx-auto space-y-4">
    <h2 class="text-2xl font-bold">${u.firstName} ${u.lastName}</h2>
    <form id="profile-form" class="flex flex-col gap-2">
      <label>First Name</label>
      <input type="text" name="firstName" class="input-field" value="${u.firstName}" required>
      <label>Last Name</label>
      <input type="text" name="lastName" class="input-field" value="${u.lastName}" required>
      <label>Birthday</label>
      <input type="date" name="birthday" class="input-field" value="${u.birthday}" required>
      <label>School</label>
      <input type="text" name="school" class="input-field" value="${u.school}" required>
      <label>Exam Year</label>
      <select name="examYear" class="input-field" required>
        <option ${u.examYear==="2026 A/L"?"selected":""}>2026 A/L</option>
        <option ${u.examYear==="2027 A/L"?"selected":""}>2027 A/L</option>
        <option ${u.examYear==="2028 A/L"?"selected":""}>2028 A/L</option>
      </select>
      <label>Phone</label>
      <input type="text" name="phone" class="input-field" value="${u.phone}" required>
      <label>Email</label>
      <input type="email" name="email" class="input-field" value="${u.email}" required>
      <button type="submit" class="liquid-btn w-full">Update Profile</button>
      <div id="profile-msg" class="text-green-400"></div>
    </form>
  </div>`;
  document.getElementById('profile-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    const updatedData = {
      firstName:f.firstName.value,
      lastName:f.lastName.value,
      birthday:f.birthday.value,
      school:f.school.value,
      examYear:f.examYear.value,
      phone:f.phone.value
    };
    await updateDoc(doc(db,'users',currentUser.uid), updatedData);
    if(f.email.value !== currentUser.email){
      try{
        await updateEmail(currentUser, f.email.value);
        await sendEmailVerification(currentUser);
        alert('Email updated. Verification email sent.');
      }catch(err){ alert(err.message); }
    }
    document.getElementById('profile-msg').textContent = 'Profile updated!';
  };
}

// ---------- Time Table ----------
async function renderTimetable() {
  if (!currentUser) { alert("Please login to access Time Table."); return; }

  const ttRef = doc(db, "timetable", currentUser.uid);
  const ttSnap = await getDoc(ttRef);
  const savedData = ttSnap.exists() ? ttSnap.data() : {};

  const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
  const hours = Array.from({length:24}, (_,i)=>{
    const fmt = (hr)=> { const suffix = hr < 12 ? "am" : "pm"; const h = hr%12||12; return `${h}${suffix}`; };
    return `${fmt(i)} - ${fmt(i+1)}`;
  });

  appContainer.innerHTML = `
    <div class="bg-slate-800 p-4 rounded-xl w-full flex flex-col gap-4">
      <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2">
        <h2 class="text-2xl font-bold">Weekly Time Table</h2>
        <div class="flex flex-wrap gap-2">
          <button id="tt-fill-free" class="liquid-btn">Fill "Free"</button>
          <button id="tt-clear" class="liquid-btn">Clear All</button>
          <button id="save-timetable" class="liquid-btn">Save Time Table</button>
          <button id="export-pdf" class="liquid-btn">Export PDF</button>
        </div>
      </div>

<p class="text-sm text-slate-400 md:hidden">
  üëâ Swipe left / right to see full timetable
</p>

      <div class="overflow-x-auto w-full">
        <table
  id="tt-table"
  class="border border-slate-600 text-sm table-auto min-w-max">
          <thead>
            <tr>
              <th class="border p-3 text-center min-w-[110px]">Hour</th>
              ${days.map(d=>`<th class="border p-3 text-center whitespace-nowrap">${d}</th>`).join("")}
            </tr>
          </thead>
          <tbody>
            ${hours.map((h, hourIndex)=>{
              return `<tr>
                <td class="border p-3 text-center whitespace-nowrap font-semibold">${h}</td>
                ${days.map((day, dayIndex)=>{
                  const cellId = `tt_${dayIndex}_${hourIndex}`;
                  const val = (savedData && savedData[cellId]) ? savedData[cellId] : "";
                  return `<td class="border p-1">
                  <input 
  id="${cellId}" 
  class="bg-slate-900 p-2 rounded text-center min-w-[130px] placeholder-slate-500 italic"
  placeholder="${h}"
  title="Time slot: ${h}"
  value="${val}">
                  </td>`;
                }).join("")}
              </tr>`;
            }).join("")}
          </tbody>
        </table>
      </div>

      <div id="tt-msg" class="text-green-400 mt-2"></div>
    </div>

    <div class="hidden md:block mt-6">
      <h2 class="text-2xl font-bold">Weekly Chart</h2>
      <canvas id="weekly-chart" class="bg-slate-800 rounded p-2 w-full" height="200"></canvas>

      <h2 class="text-2xl font-bold mt-6">Monthly Chart</h2>
      <canvas id="monthly-chart" class="bg-slate-800 rounded p-2 w-full" height="200"></canvas>
    </div>
  `;

  // ---------- Fill Free ----------
  document.getElementById("tt-fill-free").onclick = ()=> {
    days.forEach((_,d)=> hours.forEach((_,h)=>{
      const el = document.getElementById(`tt_${d}_${h}`);
      if(el && el.value.trim()==="") el.value="Free";
    }));
  };

  // ---------- Clear All ----------
  document.getElementById("tt-clear").onclick = ()=> {
    if(!confirm("Clear all timetable entries?")) return;
    days.forEach((_,d)=> hours.forEach((_,h)=>{
      const el = document.getElementById(`tt_${d}_${h}`);
      if(el) el.value="";
    }));
    document.getElementById("tt-msg").textContent = "Cleared (not saved). Press Save to persist.";
  };

  // ---------- Save ----------
  document.getElementById("save-timetable").onclick = async ()=>{
    const saveObj = {};
    days.forEach((_,d)=> hours.forEach((_,h)=>{
      const el = document.getElementById(`tt_${d}_${h}`);
      if(el && el.value.trim()!=="") saveObj[`tt_${d}_${h}`] = el.value.trim();
    }));
    try{
      await setDoc(ttRef, saveObj);
      document.getElementById("tt-msg").textContent = "Time Table saved successfully!";
    }catch(err){
      document.getElementById("tt-msg").textContent = "Save failed: " + err.message;
    }
    renderCharts();
  };

  // ---------- Render Charts ----------
  async function renderCharts(){
    const snap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',currentUser.uid)));
    const data = snap.docs.map(d=>d.data());
    const weekly=[], monthly={};
    const today=new Date();
    for(let i=6;i>=0;i--){
      const d=new Date(); d.setDate(today.getDate()-i);
      const ds=d.toISOString().slice(0,10);
      weekly.push(data.filter(x=>x.date===ds).reduce((a,b)=>a+b.hours,0));
    }
    data.forEach(x=>{
      const month=x.date.slice(0,7);
      monthly[month]=(monthly[month]||0)+x.hours;
    });

    const weeklyCanvas = document.getElementById('weekly-chart');
    if(weeklyCanvas){
      const ctxW = weeklyCanvas.getContext('2d');
      window.weeklyChart?.destroy();
      window.weeklyChart = new Chart(ctxW,{type:'line',data:{labels:Array.from({length:7},(_,i)=>{const d=new Date(); d.setDate(today.getDate()-6+i); return d.toISOString().slice(5,10);}), datasets:[{label:'Hours',data:weekly,borderColor:'#8b5cf6', backgroundColor:'rgba(139,92,246,0.3)',fill:true}]} , options:{responsive:true, plugins:{legend:{labels:{color:'#fff'}}}, scales:{x:{ticks:{color:'#fff'}}, y:{ticks:{color:'#fff'}}}}});
    }

    const monthlyCanvas = document.getElementById('monthly-chart');
    if(monthlyCanvas){
      const ctxM = monthlyCanvas.getContext('2d');
      window.monthlyChart?.destroy();
      window.monthlyChart = new Chart(ctxM,{type:'line', data:{labels:Object.keys(monthly), datasets:[{label:'Hours',data:Object.values(monthly),borderColor:'#22d3ee',backgroundColor:'rgba(34,211,238,0.3)',fill:true}]} , options:{responsive:true,plugins:{legend:{labels:{color:'#fff'}}}, scales:{x:{ticks:{color:'#fff'}}, y:{ticks:{color:'#fff'}}}}});
    }
  }

  renderCharts();

  // ---------- Export PDF ----------
document.getElementById("export-pdf").onclick = () => {
  const pdf = new jspdf.jsPDF('p', 'pt', 'a4'); // portrait, points
  const margin = 20;
  const pageWidth = pdf.internal.pageSize.getWidth();

  // ====== Table Data ======
  const tableData = [];
  hours.forEach((h, hourIndex) => {
    const row = [h];
    days.forEach((_, dayIndex) => {
      const val = document.getElementById(`tt_${dayIndex}_${hourIndex}`).value.trim();
      row.push(val || "");
    });
    tableData.push(row);
  });

  // ====== AutoTable ======
  pdf.autoTable({
    head: [['Hour', ...days]],
    body: tableData,
    theme: 'grid',
    styles: { fontSize: 10, cellPadding: 4 },
    headStyles: { fillColor: [30, 41, 59], textColor: 255 },
    alternateRowStyles: { fillColor: [240, 240, 240] },
    margin: { left: margin, right: margin },
  });

  // ====== Save PDF ======
  pdf.save(`timetable_${currentUser.uid}.pdf`);
};
}

function renderSubjects(){
  appContainer.innerHTML = `
    <h2 class="text-2xl font-bold mb-6">Select Subject</h2>

    <div class="flex flex-col gap-4">
      <button id="btn-maths" class="flex items-center gap-4 bg-slate-800 p-4 rounded-xl hover:bg-slate-700">
        <img src="https://api.combinedmaths.lk/files-public/profiles/281124/1862199793225306112.jpg" class="w-24 h-24 rounded-xl object-cover">
        <span class="text-xl font-bold">Combine Maths - Ruwan Darshana</span>
      </button>

      <button id="btn-physics" class="flex items-center gap-4 bg-slate-800 p-4 rounded-xl hover:bg-slate-700">
        <img src="https://static.indeepa.lk/lecturer/7/en/652248466c448.jpg" class="w-24 h-24 rounded-xl object-cover">
        <span class="text-xl font-bold">Physics - Anuradha Perera</span>
      </button>

      <button id="btn-chemistry" class="flex items-center gap-4 bg-slate-800 p-4 rounded-xl hover:bg-slate-700">
        <img src="https://static.indeepa.lk/lecturer/6/en/6522475ddf2bf.jpg" class="w-24 h-24 rounded-xl object-cover">
        <span class="text-xl font-bold">Chemistry - Amila Dasanayake</span>
      </button>
    </div>
  `;

  // üîπ Attach click events
  document.getElementById("btn-maths").onclick = () => renderType("maths");
  document.getElementById("btn-physics").onclick = () => renderType("physics");
  document.getElementById("btn-chemistry").onclick = () => renderType("chemistry");
}


function subjectBtn(title,img,subject){
  return `
    <button onclick="renderType('${subject}')"
      class="flex items-center gap-4 bg-slate-800 p-4 rounded-xl hover:bg-slate-700">
      <img src="${img}" class="w-24 h-24 rounded-xl object-cover">
      <span class="text-xl font-bold">${title}</span>
    </button>
  `;
}

function renderType(subject){
  appContainer.innerHTML = `
    <h2 class="text-2xl font-bold mb-6">${subject.toUpperCase()}</h2>

    <div class="flex gap-6">
      <button class="liquid-btn text-xl px-8 py-4" id="btn-theory">
        Theory
      </button>

      <button class="liquid-btn text-xl px-8 py-4" id="btn-revision">
        Revision
      </button>
    </div>
  `;

  document.getElementById("btn-theory")
    .addEventListener("click", ()=> renderLessons(subject,"theory"));

  document.getElementById("btn-revision")
    .addEventListener("click", ()=> renderLessons(subject,"revision"));
}


async function renderLessons(subject, type){

  appContainer.innerHTML = `
    <h2 class="text-2xl font-bold mb-4">
      ${subject.toUpperCase()} - ${type.toUpperCase()}
    </h2>

    <div id="lessons-list" class="flex flex-col gap-3"></div>
  `;

  const list = document.getElementById("lessons-list");

  // 1Ô∏è‚É£ Load Firestore data (optional)
  let lessonsData = {};
  try{
    const snap = await getDocs(
      query(
        collection(db,"lessons"),
        where("subject","==",subject),
        where("type","==",type)
      )
    );

    snap.forEach(doc=>{
      const d = doc.data();
      lessonsData[d.day] = d.title;
    });
  }catch(err){
    console.warn("No lessons yet, using defaults");
  }

  // 2Ô∏è‚É£ ALWAYS render 20 buttons
  for(let i=1;i<=20;i++){
    const day = String(i).padStart(2,"0");
    const title = lessonsData[day] || `Day ${day} - Lesson Title`;

    const row = document.createElement("div");
    row.className = "flex gap-2 items-center";

    const lessonBtn = document.createElement("button");
    lessonBtn.className = "liquid-btn flex-1";
    lessonBtn.id = `lesson-btn-${i}`;
    lessonBtn.textContent = title;

    row.appendChild(lessonBtn);
    lessonBtn.onclick = ()=>{
  openLessonPage(subject, type, day);
};



    // ‚úèÔ∏è Admin only
    if(currentUser && currentUser.uid === ADMIN_UID){
      const editBtn = document.createElement("button");
      editBtn.className = "liquid-btn bg-yellow-500";
      editBtn.textContent = "‚úèÔ∏è";
      editBtn.onclick = ()=> renameLesson(i, subject, type);
      row.appendChild(editBtn);
    }

    list.appendChild(row);
  }
}



async function renameLesson(i, subject, type){
  if(currentUser.uid !== ADMIN_UID){
    alert("Only admin can rename lessons.");
    return;
  }

  const day = String(i).padStart(2, "0");
  const docId = `${subject}_${type}_${day}`;
  const btn = document.getElementById(`lesson-btn-${i}`);
  const current = btn.textContent;

  const newName = prompt("New lesson name:", current);
  if(!newName) return;

  // Update button immediately
  btn.textContent = newName;

  // Save to Firestore
  await setDoc(doc(db, "lessons", docId), {
    title: newName,
    subject,
    type,
    day
  });
}

// attach to window for inline calls (if needed)
window.renameLesson = renameLesson;



async function openLessonPage(subject, type, day){
  const lessonId = `${subject}_${type}_${day}`;

  appContainer.innerHTML = `
    <h2 class="text-2xl font-bold mb-4">Lesson ${day}</h2>
    <div id="content-list" class="flex flex-col gap-3 mb-6"></div>

    ${currentUser?.uid === ADMIN_UID ? `
      <div class="flex gap-2">
        <input id="content-text" placeholder="Text" class="border p-2 flex-1 text-black">
        <input id="content-link" placeholder="Link" class="border p-2 flex-1 text-black">
        <button id="add-content-btn" class="liquid-btn">Add</button>
      </div>
    ` : ``}
  `;

  // Load existing contents
  loadLessonContents(lessonId);

  // Event listener attach ‡∂ö‡∂ª‡∂±‡∑ä‡∂± ‚Äì DOM render ‡∑Ä‡∑î‡∂±‡∑è‡∂∏
  if(currentUser?.uid === ADMIN_UID){
    document.getElementById("add-content-btn")
      .addEventListener("click", () => addContent(lessonId));
  }
}

async function loadLessonContents(lessonId){
  const list = document.getElementById("content-list");
  list.innerHTML = "";

  const q = query(
    collection(db,"lessonContents"),
    where("lessonId","==",lessonId),
    orderBy("order","asc")
  );

  const snap = await getDocs(q);

  snap.forEach(docSnap=>{
    const d = docSnap.data();
    const id = docSnap.id;

    const div = document.createElement("div");
    div.className = "border p-3 flex justify-between items-center";

    const a = document.createElement("a");
    a.href = d.link;
    a.target = "_blank";
    a.textContent = d.text;
    a.className = "text-blue-600 underline";
    div.appendChild(a);

    if(currentUser?.uid === ADMIN_UID){
      const btnContainer = document.createElement("div");
      btnContainer.className = "flex gap-2";

      const upBtn = document.createElement("button");
      upBtn.textContent = "‚¨ÜÔ∏è";
      upBtn.onclick = async () => { await moveContent(id, -1); await loadLessonContents(lessonId); };

      const downBtn = document.createElement("button");
      downBtn.textContent = "‚¨áÔ∏è";
      downBtn.onclick = async () => { await moveContent(id, 1); await loadLessonContents(lessonId); };

      const delBtn = document.createElement("button");
      delBtn.textContent = "üóëÔ∏è";
      delBtn.onclick = async () => { await deleteContent(id); await loadLessonContents(lessonId); };

      btnContainer.appendChild(upBtn);
      btnContainer.appendChild(downBtn);
      btnContainer.appendChild(delBtn);

      div.appendChild(btnContainer);
    }

    list.appendChild(div);
  });
}


	


async function addContent(lessonId){
  const text = document.getElementById("content-text").value.trim();
  const link = document.getElementById("content-link").value.trim();
  if(!text || !link) return alert("Fill all fields");

  const snap = await getDocs(
    query(collection(db,"lessonContents"), where("lessonId","==",lessonId))
  );

  await addDoc(collection(db,"lessonContents"),{
    lessonId,
    text,
    link,
    order: snap.size + 1,
    createdAt: Date.now()
  });

  document.getElementById("content-text").value = "";
  document.getElementById("content-link").value = "";

  await loadLessonContents(lessonId); // üîπ make sure to await
}



async function deleteContent(id){
  if(!confirm("Delete?")) return;
  await deleteDoc(doc(db,"lessonContents",id));
  location.reload();
}



async function moveContent(id,dir){
  const ref = doc(db,"lessonContents",id);
  const snap = await getDoc(ref);
  if(!snap.exists()) return;

  const d = snap.data();
  const newOrder = d.order + dir;
  if(newOrder < 1) return;

  const q = query(
    collection(db,"lessonContents"),
    where("lessonId","==",d.lessonId),
    where("order","==",newOrder)
  );

  const swap = await getDocs(q);
  if(swap.empty) return;

  await updateDoc(ref,{order:newOrder});
  await updateDoc(doc(db,"lessonContents",swap.docs[0].id),{order:d.order});

  loadLessonContents(d.lessonId);
}







// ---------- Admin Panel ----------
async function renderAdmin() {
  if(!currentUser || currentUser.uid!==ADMIN_UID){ 
    alert("Access Denied"); 
    return; 
  }

  appContainer.innerHTML = `
    <h2 class="text-2xl font-bold mb-4">Admin Panel</h2>
    
    <!-- Search Input -->
    <input id="admin-search" placeholder="Search by name, email, school..." class="input-field mb-4 w-full">

    <div id="admin-users" class="space-y-2"></div>
    <div id="admin-user-details" class="mt-6"></div>
  `;

  const usersSnap = await getDocs(collection(db,'users'));
  let users = usersSnap.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));
  users.sort((a,b) => a.firstName.localeCompare(b.firstName));

  const usersContainer = document.getElementById('admin-users');

  function displayUsers(list){
    usersContainer.innerHTML = '';
    list.forEach(u => {
      const div = document.createElement('div');
      div.className = 'bg-slate-800 p-3 rounded flex justify-between items-center';
      div.innerHTML = `
        <div>
          <strong>${u.firstName} ${u.lastName}</strong> (${u.email})<br>
          School: ${u.school || '-'} ‚Ä¢ Exam: ${u.examYear || '-'}
        </div>
        <div class="flex gap-2">
          <button class="liquid-btn text-white view-btn">View</button>
          <button class="liquid-btn text-white delete-btn">Delete</button>
        </div>
      `;
      div.querySelector('.view-btn').addEventListener('click', () => renderAdminUserDetails(u.id));
      div.querySelector('.delete-btn').addEventListener('click', () => deleteAdminUser(u.id, `${u.firstName} ${u.lastName}`));
      usersContainer.appendChild(div);
    });
  }

  displayUsers(users); // initial render

  // ---------- Search ----------
  const searchInput = document.getElementById('admin-search');
  searchInput.addEventListener('input', e => {
    const term = e.target.value.toLowerCase().trim();
    const filtered = users.filter(u => 
      (u.firstName + ' ' + u.lastName).toLowerCase().includes(term) ||
      (u.email || '').toLowerCase().includes(term) ||
      (u.school || '').toLowerCase().includes(term) ||
      (u.examYear || '').toLowerCase().includes(term)
    );
    displayUsers(filtered);
  });
}


  

// ---------- Admin User Details + Charts ----------
async function renderAdminUserDetails(uid){
  const detailsContainer = document.getElementById('admin-user-details');
  const userSnap = await getDoc(doc(db,'users',uid));
  if(!userSnap.exists()){ detailsContainer.innerHTML='User not found'; return; }
  const u = userSnap.data();

  const logsSnap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',uid)));
  const logs = logsSnap.docs.map(d=>d.data());

  const today = new Date();

  // ---------- Weekly Data ----------
  const weeklyData = [];
  for(let i=6;i>=0;i--){
    const d = new Date(); d.setDate(today.getDate()-i);
    const ds = d.toISOString().slice(0,10);
    const dayHours = logs.filter(x=>x.date===ds).reduce((a,b)=>a+b.hours,0);
    weeklyData.push(dayHours || 0);
  }

  // ---------- Monthly Data ----------
  const monthly = {};
  logs.forEach(x=>{
    const month = x.date.slice(0,7);
    monthly[month] = (monthly[month] || 0) + x.hours;
  });

  // ---------- Render HTML ----------
  detailsContainer.innerHTML = `
  <div class="bg-slate-800 p-4 rounded space-y-3 max-w-xl">
    <h3 class="text-xl font-bold">${u.firstName} ${u.lastName}</h3>
    <p>Email: ${u.email}</p>
    <p>Birthday: ${u.birthday}</p>
    <p>School: ${u.school}</p>
    <p>Exam: ${u.examYear}</p>
    <p>Phone: ${u.phone}</p>

    <h4 class="mt-4 font-semibold">Weekly Study Hours</h4>
    <canvas id="admin-weekly-chart" class="bg-slate-700 rounded p-2"></canvas>

    <h4 class="mt-4 font-semibold">Monthly Study Hours</h4>
    <canvas id="admin-monthly-chart" class="bg-slate-700 rounded p-2"></canvas>
  </div>`;

  // ---------- Destroy old charts ----------
  if(window.adminWeeklyChart) window.adminWeeklyChart.destroy();
  if(window.adminMonthlyChart) window.adminMonthlyChart.destroy();

  // ---------- Create Weekly Chart ----------
   const ctxW = document.getElementById('admin-weekly-chart').getContext('2d');
  window.adminWeeklyChart = new Chart(ctxW, {
    type: 'line',
    data: {
      labels: Array.from({length:7},(_,i)=>{const d=new Date(); d.setDate(today.getDate()-6+i); return d.toISOString().slice(5,10);}),
      datasets: [{
        label: 'Hours',
        data: weeklyData,
        borderColor: '#8b5cf6',
        backgroundColor: 'rgba(139,92,246,0.3)',
        fill: true,
      }]
    },
  options: {
  responsive: true,
  plugins: {
    legend: { labels: { color: '#fff' } }
  },
  scales: {
    x: {
      ticks: { color: '#fff' }
    },
    y: {
      ticks: { color: '#fff' },
      beginAtZero: true   // ‚úÖ THIS LINE
    }
  }
}
  });


  // ---------- Create Monthly Chart ----------
   const ctxM = document.getElementById('admin-monthly-chart').getContext('2d');
  // Sort months (YYYY-MM) properly
const sortedMonths = Object.keys(monthly).sort((a, b) => {
  const [yA, mA] = a.split("-").map(Number);
  const [yB, mB] = b.split("-").map(Number);
  return yA === yB ? mA - mB : yA - yB;
});

// Map values to sorted months
const monthlyValues = sortedMonths.map(m => monthly[m]);

// Format labels as "Jan 2026", "Feb 2026", etc.
const monthLabels = sortedMonths.map(m => {
  const [year, month] = m.split("-");
  return new Date(year, month - 1).toLocaleString("en", { month: "short", year: "numeric" });
});

// Create chart
window.adminMonthlyChart = new Chart(ctxM, {
  type: 'line',
  data: {
    labels: monthLabels,
    datasets: [{
      label: 'Hours',
      data: monthlyValues,
      borderColor: '#22d3ee',
      backgroundColor: 'rgba(34,211,238,0.3)',
      fill: true,
    }]
  },
    options: {
  responsive: true,
  plugins: {
    legend: { labels: { color: '#fff' } }
  },
  scales: {
    x: {
      ticks: { color: '#fff' }
    },
    y: {
      ticks: { color: '#fff' },
      beginAtZero: true   // ‚úÖ THIS LINE
    }
  }
}
  });
}


// ---------- Admin Delete ----------
async function deleteAdminUser(uid,name){
  if(confirm(`Delete user ${name}?`)){
    await deleteDoc(doc(db,'users',uid));
    renderAdmin();
  }
}

 
async function addRecording(){
  const title = document.getElementById("rec-title").value.trim();
  const link = document.getElementById("rec-link").value.trim();
  const subject = document.getElementById("rec-subject").value;
  const type = document.getElementById("rec-type").value;

  if(!title || !link){
    alert("Title ‡∑É‡∑Ñ Link ‡∂Ø‡∑ô‡∂ö‡∂∏ ‡∂Ø‡∑è‡∂±‡∑ä‡∂±");
    return;
  }

  await addDoc(collection(db,"recordings"),{
    title,
    link,
    subject,
    type,
    createdAt: new Date().toISOString()
  });

  alert("Recording Added!");

  // Clear inputs
  document.getElementById("rec-title").value = "";
  document.getElementById("rec-link").value = "";

  // Optionally, render lessons immediately if current subject/type matches
  renderLessons(subject,type);
}


// <-- FIX: Attach to window for inline onclick -->
window.renderAdminUserDetails = renderAdminUserDetails;
window.deleteAdminUser = deleteAdminUser;
window.renderTimetable = renderTimetable;
// ---------- FIX RECORDING BUTTONS ----------
window.renderSubjects = renderSubjects;
window.renderType = renderType;
window.renderLessons = renderLessons;
window.deleteRecording = deleteRecording;
window.renameLesson = renameLesson;
window.renderType = renderType;
window.moveContent = moveContent;
window.addContent = addContent;
window.deleteContent = deleteContent;
window.deleteRecording = deleteRecording;




</script>

<style>
body{background:black;color:white;min-height:100vh;}
.input-field{padding:0.5rem;border-radius:0.5rem;background:#1e293b;border:none;color:white;width:100%;}
.liquid-btn{position:relative;padding:0.5rem 1.5rem;color:white;overflow:hidden;border:none;border-radius:1rem;background:#0ea5e9;cursor:pointer;font-weight:bold;margin:0.2rem;transition:0.3s;}
.liquid-btn::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:rgba(255,255,255,0.2);transform:skewX(-20deg);transition:0.5s;}
.liquid-btn:hover::before{left:100%;}
.liquid-btn:hover{box-shadow:0 0 20px #0ea5e9;}
.google-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 0.5rem 1.5rem;
  border: 2px solid #0ea5e9;
  border-radius: 0.5rem;
  background: transparent;
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
.google-btn:hover {
  background: rgba(14, 165, 233, 0.1);
  box-shadow: 0 0 10px #0ea5e9;
}
.google-logo {
  width: 20px;
  height: 20px;
}


</style>
</head>
<body class="flex flex-col items-center justify-start p-4 min-h-screen">

<header class="w-full p-4 bg-gradient-to-r from-slate-900 via-indigo-900 to-slate-900 shadow-lg flex justify-between items-center flex-wrap">
  <h1 class="text-2xl font-bold">StudyTracker</h1>
  <div id="header-greeting" class="text-lg"></div>
  <div id="header-buttons" class="flex gap-2 flex-wrap"></div>
</header>

<main
  class="flex-1 w-full max-w-xl sm:max-w-3xl lg:max-w-7xl mt-4 px-2 sm:px-4"
  id="app-container">
</main>


<footer class="text-sm text-slate-400 mt-4 w-full text-center">
  ¬© Owner 2026
</footer>

</body>
</html>
